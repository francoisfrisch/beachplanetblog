montageDefine("8d02820","runtime/animation",{dependencies:["runtime/dependencies/gl-matrix","runtime/base","runtime/transform","runtime/utilities"],factory:function(e,t){function n(e){function t(e,t){return 1-3*t+3*e}function n(e,t){return 3*t-6*e}function i(e){return 3*e}function r(e,r,a){return((t(r,a)*e+n(r,a))*e+i(r))*e}function a(e,r,a){return 3*t(r,a)*e*e+2*n(r,a)*e+i(r)}function s(e){for(var t=e,n=0;4>n;++n){var i=a(t,o,h);if(0==i)return t;var s=r(t,o,h)-e;t-=s/i}return t}var o=e[0],l=e[1],h=e[2],u=e[3];this.get=function(e){return o==l&&h==u?e:r(s(e),l,u)}}function i(e,t,n){var i=Object.create(s).init();return e.interpolateToTransform(t,n,i),i}function r(e,t,n){return e+(t-e)*n}e("runtime/dependencies/gl-matrix");var a=e("runtime/base").Base,s=e("runtime/transform").Transform;e("runtime/utilities").Utilities;var o={ease:[.25,.1,.25,1],linear:[0,0,1,1],"ease-in":[.42,0,1,1],"ease-out":[0,0,.58,1],"ease-in-out":[.42,0,.58,1]},l=t.Channel=Object.create(a,{startTime:{value:0,writable:!0},endTime:{value:-1,writable:!0},_sampler:{value:null,writable:!0},sampler:{get:function(){return this._sampler},set:function(e){this._sampler=e}},_target:{value:null,writable:!0},target:{get:function(){return this._target},set:function(e){this._target=e}},_path:{value:null,writable:!0},path:{get:function(){return this._path},set:function(e){this._path=e}},parameterDelegate:{value:{handleError:function(e,t){console.log("ERROR:parameterDelegate:"+e+" :"+t)},decode:function(e,t){function n(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),i=0,r=e.length;r>i;i++)n[i]=e.charCodeAt(i);return t}if(t){var i="ascii"==t.extensions["Open3DGC-compression"].compressedData.mode?"text":"arraybuffer";if("text"===i)var r=new o3dgc.BinaryStream(n(e)),a=e.length;else var r=new o3dgc.BinaryStream(e),a=e.byteLength;var s=new o3dgc.DynamicVectorDecoder,o=new o3dgc.DynamicVector,l=new o3dgc.Timer;return l.Tic(),s.DecodeHeader(o,r),l.Toc(),console.log("DecodeHeader time (ms) "+l.GetElapsedTime()),o.GetNVector()>0&&o.GetDimVector()&&(o.SetVectors(new Float32Array(o.GetNVector()*o.GetDimVector())),o.SetMinArray(new Float32Array(o.GetDimVector())),o.SetMaxArray(new Float32Array(o.GetDimVector())),o.SetStride(o.GetDimVector())),console.log("Dynamic vector info:"+t.id),console.log("	# vectors   "+o.GetNVector()),console.log("	dim         "+o.GetDimVector()),l.Tic(),s.DecodePlayload(o,r),l.Toc(),console.log("DecodePlayload time "+l.GetElapsedTime()+" ms, "+a+" bytes ("+8*a/o.GetNVector()+" bpv)"),o.GetVectors()}},convert:function(e,t,n){var i=n;if(i.extensions){var r=i.extensions,a=r["Open3DGC-compression"];if(a){var s=a.compressedData;if(s)return this.decode(t,n)}}return new Float32Array(t)},resourceAvailable:function(){}}},getParameterArray:{value:function(e,t){if(e.extensions){var n=e.extensions,i=n["Open3DGC-compression"];if(i){var r=i.compressedData;if(r)return t.getResource(r,this.parameterDelegate,e)}}return t.getResource(e,this.parameterDelegate,e)}},updateTargetsAtTime:{value:function(e,t){var n=this.sampler.input,i=this.sampler.output,r=this.getParameterArray(n,t),a=this.getParameterArray(i,t);if(r&&a){e/=1e3;var s=n.count;this.endTime=r[s-1],this.startTime=r[0];var o,l=0,h=0,u=0;if(s>0){if(this.startTime>e)h=0,l=0;else if(e>=this.endTime)h=1,l=s-2;else for(o=l;s-1>o;o++)if(e>=r[o]&&r[o+1]>e){l=o,u=r[o+1]-r[o],h=(e-r[o])/u;break}null==this.__vec4&&(this.__vec4=vec4.create()),null==this.__vec3&&(this.__vec3=vec3.create()),null==this.__vec2&&(this.__vec2=vec2.create());var c=null;switch(i.componentsPerAttribute){case 4:c=this.__vec4;break;case 3:c=this.__vec3;break;case 2:c=this.__vec2;break;case 1:console.log("float interpolation not handled yet");break;default:}this.index=l;var p=l*i.componentsPerAttribute,d=p+i.componentsPerAttribute,m=this.path;if("rotation"===m){m="orientation";var f=0,g=1,v=2,y=v;if(y==f){var _=vec4.createFrom(a[p+0],a[p+1],a[p+2],a[p+3]),b=vec4.createFrom(a[d+0],a[d+1],a[d+2],a[d+3]);vec3.normalize(_),vec3.normalize(b);var w=vec3.create();vec3.cross(_,b,w),Math.sqrt(vec3.dot(_,_)),Math.sqrt(vec3.dot(b,b));var C=Math.acos(vec3.dot(_,b)),x=mat4.identity();mat4.rotate(x,C*h,w),mat4.multiplyVec3(x,_,w),vec3.normalize(w);var S=_[3]+(b[3]-_[3])*h;quat4.fromAngleAxis(S,w,c)}else if(y==g){var _=vec4.createFrom(a[p+0],a[p+1],a[p+2],a[p+3]),b=vec4.createFrom(a[d+0],a[d+1],a[d+2],a[d+3]);for(o=0;c.length>o;o++){var E=_[o],O=b[o];b[o]=E+(O-E)*h}quat4.fromAngleAxis(b[3],b,c)}else if(y==v){null==this._quats&&(this._quats=[],this._quats.push(quat4.create()),this._quats.push(quat4.create())),null==this._vecs&&(this._vecs=[],this._vecs.push(vec3.create()),this._vecs.push(vec3.create())),this._vecs[0][0]=a[p+0],this._vecs[0][1]=a[p+1],this._vecs[0][2]=a[p+2],this._vecs[1][0]=a[d+0],this._vecs[1][1]=a[d+1],this._vecs[1][2]=a[d+2];var T=this._quats[0],L=this._quats[1];quat4.fromAngleAxis(a[p+3],this._vecs[0],T),quat4.fromAngleAxis(a[d+3],this._vecs[1],L),quat4.slerp(T,L,h,c)}}else for(o=0;c.length>o;o++){var E=a[p+o],O=a[d+o];c[o]=E+(O-E)*h}this.target.transform[m]=c}}}},initWithDescription:{value:function(e){return this.init(),this.index=0,this.target=e.target,this}},init:{value:function(){return this.__Base_init(),this}}}),h=Object.create(a,{_input:{value:null,writable:!0},input:{get:function(){return this._input},set:function(e){this._input=e}},_output:{value:null,writable:!0},output:{get:function(){return this._output},set:function(e){this._output=e}},initWithDescription:{value:function(){return this.init(),this}},init:{value:function(){return this.__Base_init(),this}}}),u=t.Animation=Object.create(Object.prototype,{KEYFRAME:{value:"KEYFRAME",writable:!0},BASIC:{value:"BASIC",writable:!0},_type:{value:null,writable:!0},type:{set:function(e){this._type=e},get:function(){return this._type}},_delegate:{value:null,writable:!0},delegate:{set:function(e){this._delegate=e},get:function(){return this._delegate}}});t.BasicAnimation=Object.create(u,{_startTime:{value:0,writable:!0},_from:{value:null,writable:!0},_to:{value:null,writable:!0},_duration:{value:0,writable:!0},path:{value:null,writable:!0},target:{value:null,writable:!0},_interpolator:{value:null,writable:!0},extras:{value:null,writable:!0},_timingFunction:{value:null,writable:!0},_bezier:{value:null,writable:!0},timingFunction:{set:function(e){this._timingFunction=e},get:function(){return this._timingFunction||"ease"}},_inferInterpolatorFromValue:{value:function(e){return isNaN(e-0)||null==e?e instanceof Object?i:nil:r}},to:{set:function(e){this._interpolator=this._inferInterpolatorFromValue(e),this._to=e},get:function(){return this._to}},from:{set:function(e){this._from=e},get:function(){return this._from}},duration:{set:function(e){this._duration=e},get:function(){return this._duration}},_evaluateAtTime:{value:function(e){var t=(e-this._startTime)/this.duration;if(t>1&&(t=1),0>t&&(t=0),null==this._bezier){var i=o[this.timingFunction]||"ease";this._bezier=new n(i)}t=this._bezier.get(t);var r=this._interpolator(this._from,this._to,t);this.target&&this.path&&(this.target[this.path]=r,this.delegate.animationDidUpdate(this))}},animationWasAddedToTarget:{value:function(){this._startTime=Date.now()}},animationWasRemovedFromTarget:{value:function(){this._startTime=0}},init:{value:function(){return this.type=u.BASIC,this.extras={},this}}}),t.KeyframeAnimation=Object.create(u,{_count:{value:0,writable:!0},_parameters:{value:null,writable:!0},_channels:{value:null,writable:!0},_samplers:{value:null,writable:!0},_startTime:{value:0,writable:!0},_endTime:{value:-1,writable:!0},channels:{get:function(){return this._channels},set:function(e){this._channels=e}},samplers:{get:function(){return this._samplers},set:function(e){this._samplers=e}},parameters:{get:function(){return this._parameters},set:function(e){this._parameters=e}},count:{get:function(){return this._count},set:function(e){this._count=e}},startTime:{get:function(){if(this.channels){if(this.channels.length>0){for(var e=this.channels[0].startTime,t=1;this.channels.length>t;t++)e>this.channels[t].startTime&&(e=this.channels[t].startTime);return e}return 0}}},endTime:{get:function(){if(this.channels){if(this.channels.length>0){for(var e=this.channels[0].endTime,t=1;this.channels.length>t;t++)this.channels[t].endTime>e&&(e=this.channels[t].endTime);return e}return-1}}},updateTargetsAtTime:{value:function(e,t){this.channels.forEach(function(n){n.updateTargetsAtTime(e,t)},this)}},initWithDescription:{value:function(e){return this.init(),this.count=e.count,Object.keys(e.samplers).forEach(function(t){var n=e.samplers[t],i=Object.create(h).initWithDescription(n);this.samplers[t]=i},this),e.channels.forEach(function(e){var t=Object.create(l).initWithDescription(e);t.sampler=this.samplers[e.sampler],t.target=e.target,this.channels.push(t)},this),this}},init:{value:function(){return this.channels=[],this.samplers={},this.type=u.KEYFRAME,this}}})}});