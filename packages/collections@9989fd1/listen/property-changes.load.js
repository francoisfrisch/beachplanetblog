montageDefine("9989fd1","listen/property-changes",{dependencies:["../shim","weak-map"],factory:function(e,t,r){function n(){throw Error("This is an abstract interface. Mix it. Don't construct it")}e("../shim");var i=e("weak-map"),a=Object.prototype.hasOwnProperty,o=new i,s=new i;r.exports=n,n.debug=!0,n.prototype.getOwnPropertyChangeDescriptor=function(e){o.has(this)||o.set(this,{});var t=o.get(this);return a.call(t,e)||(t[e]={willChangeListeners:[],changeListeners:[]}),t[e]},n.prototype.hasOwnPropertyChangeDescriptor=function(e){if(!o.has(this))return!1;if(!e)return!0;var t=o.get(this);return a.call(t,e)?!0:!1},n.prototype.addOwnPropertyChangeListener=function(e,t,r){this.makeObservable&&!this.isObservable&&this.makeObservable();var i,a=n.getOwnPropertyChangeDescriptor(this,e);i=r?a.willChangeListeners:a.changeListeners,n.makePropertyObservable(this,e),i.push(t);var o=this;return function(){n.removeOwnPropertyChangeListener(o,e,i,r),o=null}},n.prototype.addBeforeOwnPropertyChangeListener=function(e,t){return n.addOwnPropertyChangeListener(this,e,t,!0)},n.prototype.removeOwnPropertyChangeListener=function(e,t,r){var i,a=n.getOwnPropertyChangeDescriptor(this,e);i=r?a.willChangeListeners:a.changeListeners;var o=i.lastIndexOf(t);if(-1===o)throw Error("Can't remove listener: does not exist.");i.splice(o,1),0===a.changeListeners.length+a.willChangeListeners.length&&n.makePropertyUnobservable(this,e)},n.prototype.removeBeforeOwnPropertyChangeListener=function(e,t){return n.removeOwnPropertyChangeListener(this,e,t,!0)},n.prototype.dispatchOwnPropertyChange=function(e,t,r){var i=n.getOwnPropertyChangeDescriptor(this,e);if(!i.isActive){i.isActive=!0;var a;a=r?i.willChangeListeners:i.changeListeners;var o=(r?"Will":"")+"Change",s="handleProperty"+o,p=e+"";p=p&&p[0].toUpperCase()+p.slice(1);var c="handle"+p+o;try{a.forEach(function(r){var n=r;if(r=r[c]||r[s]||r,!r.call)throw Error("No event listener for "+c+" or "+s+" or call on "+r);r.call(n,t,e,this)},this)}finally{i.isActive=!1}}},n.prototype.dispatchBeforeOwnPropertyChange=function(e,t){return n.dispatchOwnPropertyChange(this,e,t,!0)},n.prototype.makePropertyObservable=function(e){if(!Array.isArray(this)){if(!Object.isExtensible(this,e))throw Error("Can't make property "+JSON.stringify(e)+" observable on "+this+" because object is not extensible");var t;"object"==typeof this.__state__?t=this.__state__:(t={},Object.isExtensible(this,"__state__")&&Object.defineProperty(this,"__state__",{value:t,writable:!0,enumerable:!1})),t[e]=this[e],s.has(this)||(r={},s.set(this,r));var r=s.get(this);if(!a.call(r,e)){var i,o=this;Object.getOwnPropertyDescriptor(o,e);do{if(i=Object.getOwnPropertyDescriptor(o,e))break;o=Object.getPrototypeOf(o)}while(o);if(i=i||{value:void 0,enumerable:!0,writable:!0,configurable:!0},!i.configurable)throw Error("Can't observe non-configurable properties");if(r[e]=i,i.writable||i.set){var p;p="value"in i?{get:function(){return i.value},set:function(r){return r===i.value?r:(n.dispatchBeforeOwnPropertyChange(this,e,i.value),i.value=r,t[e]=r,n.dispatchOwnPropertyChange(this,e,r),r)},enumerable:i.enumerable,configurable:!0}:{get:function(){return i.get?i.get.apply(this,arguments):void 0},set:function(r){var a;return i.get&&(a=i.get.apply(this,arguments)),i.set&&i.set.apply(this,arguments),i.get&&(r=i.get.apply(this,arguments),t[e]=r),r===a?r:(n.dispatchBeforeOwnPropertyChange(this,e,a),n.dispatchOwnPropertyChange(this,e,r),r)},enumerable:i.enumerable,configurable:!0},Object.defineProperty(this,e,p)}}}},n.prototype.makePropertyUnobservable=function(e){if(!Array.isArray(this)){if(!s.has(this))throw Error("Can't uninstall observer on property");var t=s.get(this);if(!t[e])throw Error("Can't uninstall observer on property");var r=t[e];delete t[e];var n;"object"==typeof this.__state__?n=this.__state__:(n={},Object.isExtensible(this,"__state__")&&Object.defineProperty(this,"__state__",{value:n,writable:!0,enumerable:!1})),delete n[e],Object.defineProperty(this,e,r)}},n.getOwnPropertyChangeDescriptor=function(e,t){return e.getOwnPropertyChangeDescriptor?e.getOwnPropertyChangeDescriptor(t):n.prototype.getOwnPropertyChangeDescriptor.call(e,t)},n.hasOwnPropertyChangeDescriptor=function(e,t){return e.hasOwnPropertyChangeDescriptor?e.hasOwnPropertyChangeDescriptor(t):n.prototype.hasOwnPropertyChangeDescriptor.call(e,t)},n.addOwnPropertyChangeListener=function(e,t,r,i){return Object.isObject(e)?e.addOwnPropertyChangeListener?e.addOwnPropertyChangeListener(t,r,i):n.prototype.addOwnPropertyChangeListener.call(e,t,r,i):void 0},n.removeOwnPropertyChangeListener=function(e,t,r,i){return Object.isObject(e)?e.removeOwnPropertyChangeListener?e.removeOwnPropertyChangeListener(t,r,i):n.prototype.removeOwnPropertyChangeListener.call(e,t,r,i):void 0},n.dispatchOwnPropertyChange=function(e,t,r,i){return Object.isObject(e)?e.dispatchOwnPropertyChange?e.dispatchOwnPropertyChange(t,r,i):n.prototype.dispatchOwnPropertyChange.call(e,t,r,i):void 0},n.addBeforeOwnPropertyChangeListener=function(e,t,r){return n.addOwnPropertyChangeListener(e,t,r,!0)},n.removeBeforeOwnPropertyChangeListener=function(e,t,r){return n.removeOwnPropertyChangeListener(e,t,r,!0)},n.dispatchBeforeOwnPropertyChange=function(e,t,r){return n.dispatchOwnPropertyChange(e,t,r,!0)},n.makePropertyObservable=function(e,t){return e.makePropertyObservable?e.makePropertyObservable(t):n.prototype.makePropertyObservable.call(e,t)},n.makePropertyUnobservable=function(e,t){return e.makePropertyUnobservable?e.makePropertyUnobservable(t):n.prototype.makePropertyUnobservable.call(e,t)}}});